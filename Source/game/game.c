#include <stdio.h>
#include <stdlib.h>

#include "./game.h"
#include "../GLCD//GLCD.h"

static Game *GameVar = NULL;

uint16_t lifePixels[] = {
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 
0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 
0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 
0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 
0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 
65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 
65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 
65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 
0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 
65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 
0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 
0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 
0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 
0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 65120, 65120, 65120, 65120, 65120, 65120, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 
};

uint8_t map[200][240];

void GameInit(void) {
	GameVar = (Game *) malloc(sizeof(Game));
	if (GameVar == NULL) {
		exit(1);
	}
	GameVar->currentState = GAME_STATE_START;  // Start game state
  GameVar->score = 0;                          // Initial score is 0
  GameVar->lives = 1;                          // Initial number of lives is 1
	GameVar->pills = 240; 										   // Initial number of pills is 240
  GameVar->time = 25;                           // Start with 60s remaining
}

void TogglePause() {
	if (GameVar->currentState == GAME_STATE_PAUSED) {
		GameVar->currentState = GAME_STATE_RESUMED;
	} else if (GameVar->currentState == GAME_STATE_PLAYING) {
		GameVar->currentState = GAME_STATE_PAUSED;
	}
}

void UpdateSeconds() {
	switch (GameVar->currentState) {
		case GAME_STATE_START:
			LCD_DrawTime(GameVar->time);
			LCD_DrawScore(GameVar->score);
			LCD_DrawMap();
			LCD_DrawImage(20, 280, 30, lifePixels);
			GameVar->currentState = GAME_STATE_PAUSED;
		  break;
		
		case GAME_STATE_PLAYING:
			GameVar->time = GameVar->time >= 1 ? GameVar->time-1 : 0;
			LCD_DrawTime(GameVar->time);
		  LCD_DrawScore(GameVar->score);
			if (GameVar->time == 0) {
				if (GameVar->pills > 0)
					LCD_DrawGameOver();
				else
					LCD_DrawWinMessage();
				GameVar->currentState = GAME_STATE_GAME_OVER;
			}
			break;
			
		case GAME_STATE_PAUSED:
			LCD_DrawPauseMessage();
		  break;
		
		case GAME_STATE_RESUMED:
			LCD_ClearMessage();
			GameVar->currentState = GAME_STATE_PLAYING;
			break;			
		
		default:
			break;
	}
}

void Draw() {
	
}